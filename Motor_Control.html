<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />



  <title>Password Protected Control</title>
  <style>
    *, *::before, *::after {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 10px;
      background: linear-gradient(135deg, #c1e0da, #acb6e5);
      font-family: 'Segoe UI', sans-serif;
      min-height: 100vh;
      backdrop-filter: blur(4px);
      display: flex;
      justify-content: center;
      align-items: center;
      overflow-x: hidden;
    }

    .container {
      background: white;
      padding: 20px 30px;
      border-radius: 15px;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
      width: 100%;
      max-width: 400px;
      text-align: center;
      margin: 0 10px;
    }

    input[type="password"] {
      width: 100%;
      padding: 10px;
      margin-bottom: 12px;
      font-size: 16px;
      border-radius: 8px;
      border: 1px solid #ccc;
    }

    .error {
      color: red;
      font-size: 14px;
      height: 20px;
    }

    .toggle {
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 10px 0;
    }

    .toggle input {
      display: none;
    }

    .toggle label {
      position: relative;
      display: inline-block;
      width: 60px;
      height: 30px;
      background: #ccc;
      border-radius: 30px;
      cursor: pointer;
      transition: background 0.3s;
    }

    .toggle label::after {
      content: "";
      position: absolute;
      top: 3px;
      left: 3px;
      width: 24px;
      height: 24px;
      background: white;
      border-radius: 50%;
      transition: 0.3s;
    }

    .toggle input:checked + label {
      background: #4caf50;
    }

    .toggle input:checked + label::after {
      transform: translateX(30px);
    }

    .box {
      margin-top: 20px;
      padding: 15px;
      background: #e3f2fd;
      border: 1px solid #90caf9;
      border-radius: 8px;
      display: none;
    }

    .box.visible {
      display: block;
    }

    .mode-text {
      font-weight: bold;
      font-size: 18px;
      margin-bottom: 10px;
    }

    .motor-control {
      margin-top: 15px;
      text-align: left;
    }

    .motor-control span {
      font-weight: bold;
      font-size: 16px;
    }

    .motor-toggle {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    button {
      padding: 12px 24px;
      margin-top: 10px;
      background: #2196f3;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      width: 100%;
      transition: background 0.3s;
    }

    button:hover {
      background: #1769aa;
    }

    a {
      display: inline-block;
      margin-top: 10px;
      text-decoration: none;
      background: #009688;
      color: white;
      padding: 12px 20px;
      border-radius: 6px;
      font-size: 16px;
      transition: background 0.3s;
    }

    a:hover {
      background: #00796b;
    }

    @media (max-width: 480px) {
      .container {
        padding: 15px 20px;
        max-width: 100%;
      }

      .mode-text {
        font-size: 16px;
      }

      .motor-control span {
        font-size: 14px;
      }

      button, a {
        padding: 10px;
        font-size: 14px;
      }

      .toggle label {
        width: 50px;
        height: 26px;
      }

      .toggle label::after {
        width: 22px;
        height: 22px;
        top: 2px;
        left: 2px;
      }

      .toggle input:checked + label::after {
        transform: translateX(24px);
      }
    }


  .button-row {
    display: flex;
    gap: 12px;
    justify-content: center;
    margin-top: 20px;
    flex-wrap: wrap;
  }


.cat-button {
  flex: 1 1 auto;
  max-width: 200px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  padding: 10px 16px;           /* Reduced padding */
  font-size: 15px;              /* Slightly smaller font */
  font-weight: 600;
  border: none;
  border-radius: 10px;
  text-decoration: none;
  color: white;
  background: linear-gradient(135deg, #798b97, #7873f5);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
  transition: all 0.3s ease;
  cursor: pointer;
  height: auto;                /* Prevent fixed height */
  min-height: 42px;            /* Ensure it's tappable */
  line-height: 1.2;            /* Balanced text height */
}

.cat-button:hover {
  transform: scale(1.05);
  background: linear-gradient(135deg, #a18f9b, #5f5bd7);
}

.cat-button i {
  font-size: 17px;
}

/* Mobile Responsive */
@media (max-width: 500px) {
  .button-row {
    flex-direction: column;
    align-items: center;
    gap: 10px;
  }

  .cat-button {
    width: 100%;
    max-width: none;
    font-size: 14px;
    padding: 10px 14px;
  }
}



  </style>
</head>
<body>
  <div class="container">

    <h2>Enter Password</h2>
    
    <input type="password" id="passwordInput" placeholder="Password" inputmode="numeric" pattern="\d*" />

     <div id="data-container">

      

     </div>
     

<div class="button-row">


    
  <button id="loginBtn" class="cat-button">
    <i class="fa-solid fa-cat"></i> Login
  </button>

  <a href="index.html" class="cat-button">
    <i class="fa-solid fa-cat"></i>  Display 
  </a>




</div>

    <div class="error" id="errorMsg"></div>

    <h3 id="Test"></h3>

    <div class="box" id="secretBox">
      <div class="mode-text" id="modeLabel">Mode: Manual</div>
      <div class="toggle">
        <input type="checkbox" id="modeSwitch" />
        <label for="modeSwitch"></label>
      </div>

      <div id="motorSection" class="motor-control">
        <div class="motor-toggle">
          <span>Motor 1</span>
          <div class="toggle">
            <input type="checkbox" id="motor1" />
            <label for="motor1"></label>
          </div>
        </div>
        <div class="motor-toggle">
          <span>Motor 2</span>
          <div class="toggle">
            <input type="checkbox" id="motor2" />
            <label for="motor2"></label>
          </div>
        </div>
        <div class="motor-toggle">
          <span>Motor 3</span>
          <div class="toggle">
            <input type="checkbox" id="motor3" />
            <label for="motor3"></label>
          </div>
        </div>
        <div class="motor-toggle">
          <span>Motor 4</span>
          <div class="toggle">
            <input type="checkbox" id="motor4" />
            <label for="motor4"></label>
          </div>
        </div>
      </div>
    </div>
  </div>


  


  <script>


  let on_data = 1; // 0 = Auto, 1 = Manual
  let motor1_state = 0;
  let motor2_state = 0;
  let motor3_state = 0;
  let motor4_state = 0;

  let inter_Lock = 0;

    const correctPassword = "";
  const passwordInput = document.getElementById("passwordInput");
  const loginBtn = document.getElementById("loginBtn");
  const secretBox = document.getElementById("secretBox");
  const errorMsg = document.getElementById("errorMsg");
  const modeSwitch = document.getElementById("modeSwitch");
  const modeLabel = document.getElementById("modeLabel");
  const motorSection = document.getElementById("motorSection");

  const motor1Toggle = document.getElementById("motor1");
  const motor2Toggle = document.getElementById("motor2");
  const motor3Toggle = document.getElementById("motor3");
  const motor4Toggle = document.getElementById("motor4");




 // Read Firebase

      
const FIREBASE_HOST = "https://uditha-2fc62-default-rtdb.asia-southeast1.firebasedatabase.app";
const FIREBASE_AUTH = "0PfE9nU0OvR4CnRhVWMaQPFnSupj63CIGggX6bKU";

function readFromFirebase() {
  const url = `${FIREBASE_HOST}/on_off_motor.json?auth=${FIREBASE_AUTH}`;

  fetch(url)
    .then(response => response.json())
    .then(data => {
      let onOffMotorValue = data;

      // Show value in No_Power_BATTRY
    //  document.getElementById('No_Power_BATTRY').innerHTML =
      //  `24V Battery : <span style="color: indigo;">${onOffMotorValue}</span>`;

      // ‚úÖ Get first digit
      let firstDigit = parseInt(onOffMotorValue.toString()[0]);



      // ‚úÖ IF condition and display in No_Power_CEB
      if (firstDigit === 1 ) {

       // document.getElementById('No_Power_CEB').innerHTML =
         // `24V Battery : <span style="color: indigo;">${firstDigit}</span>`;

            on_data = 0;
            modeSwitch.checked = 1;
            updateModeDisplay();

      } else {

       // document.getElementById('No_Power_CEB').innerHTML =
         // `24V Battery : <span style="color: red;">Other: ${firstDigit}</span>`;

           on_data = 1;
           modeSwitch.checked = 0;
           updateModeDisplay();
      }
    })
    .catch(error => {
      console.error("‚ùå Error reading Firebase:", error);
    });
}

     // üîÅ Call every 2 seconds
    setInterval(readFromFirebase, 200);

  



 // end 












  let attempts = 0;
  let locked = false;



  let M1 = "1";
  let M2 = "1";
  let M3 = "1";
  let M4 = "1";
 

  let A_M = "1";




 


 


  function updateToggleFromVariable() {

    modeSwitch.checked = on_data === 0;  //// Togal eka on off kirima coding walin Click
   // motor1Toggle.checked = 0; 

    updateModeDisplay();
  }


  function updateModeDisplay() {

    const isManual = !modeSwitch.checked;
    modeLabel.textContent = `Mode: ${isManual ? "Manual" : "Auto"}`;
    motorSection.style.display = isManual ? "block" : "none";  //////// un hide kirima





  }






  function tryLogin() {
    if (locked) return;

    const input = passwordInput.value;
    if (input === correctPassword) {
      secretBox.style.display = "block";
      errorMsg.textContent = "";
      updateToggleFromVariable();
    } else {
      attempts++;
      errorMsg.textContent = `Incorrect password (${attempts}/3)`;
      if (attempts >= 3) {
        locked = true;
        errorMsg.textContent = "Too many attempts. Try again in 30s.";
        passwordInput.disabled = true;
        loginBtn.disabled = true;
        setTimeout(() => {
          passwordInput.disabled = false;
          loginBtn.disabled = false;
          errorMsg.textContent = "";
          attempts = 0;
          locked = false;
        }, 30000);
      }
    }
  }

  passwordInput.addEventListener("keydown", (e) => {
    if (e.key === "Enter") {
      tryLogin();
    }
  });

  loginBtn.addEventListener("click", tryLogin);

  modeSwitch.addEventListener("change", () => { // Auto Manual

    on_data = modeSwitch.checked ? 1 : 0;

       if(on_data === 1){  // Auto
      
      A_M = "1"; 
      M1 = "1"
      M1 = "1"
      M1 = "1"
      M2 = "1"
      M2 = "1"
      M2 = "1"
      M3 = "1"
      M3 = "1"
      M3 = "1"
      M4 = "1"
      M4 = "1"
      M4 = "1" 
      
    
    } 


    if(on_data === 0){  // Manual
      
       A_M = "2"; 
       M1 = "1"
       M1 = "1"
       M1 = "1"
       M2 = "1"
       M2 = "1"
       M2 = "1"
       M3 = "1"
       M3 = "1"
       M3 = "1"
       M4 = "1"
       M4 = "1"
       M4 = "1" 
       motor1Toggle.checked = 0; //togal sw coding off
       motor2Toggle.checked = 0; 
       motor3Toggle.checked = 0; 
       motor4Toggle.checked = 0;      
          
    } 





    updateModeDisplay();   

    const valueToSend = on_data === 1 ?  parseInt(A_M + M1 + M2 + M3 + M4) : parseInt(A_M + M1 + M2 + M3 + M4);
   // document.getElementById("Test").innerHTML = `Pump Unit : <span style="color: green;">${valueToSend}</span>`;

    sendToFirebase(valueToSend);


  });




  motor1Toggle.addEventListener("change", () => { /// Motor 1 togal send firebase

    motor1_state = motor1Toggle.checked ? 1 : 0;

     if(motor1_state === 0){ M1 = "1"; } 
     if(motor1_state === 1){ M1 = "2"; } 

    updateModeDisplay();

    const valueToSend = motor1_state === 1 ? parseInt(A_M + M1 + M2 + M3 + M4) : parseInt(A_M + M1 + M2 + M3 + M4);
  //  document.getElementById("Test").innerHTML = `Pump Unit : <span style="color: green;">${valueToSend}</span>`; // display

    sendToFirebase(valueToSend);



  });





  motor2Toggle.addEventListener("change", () => { /// Motor 2 togal send firebase

    motor2_state = motor2Toggle.checked ? 1 : 0;

     if(motor2_state === 0){ M2 = "1"; } 
     if(motor2_state === 1){ M2 = "2"; } 

    updateModeDisplay();

    const valueToSend = motor2_state === 1 ? parseInt(A_M + M1 + M2 + M3 + M4) : parseInt(A_M + M1 + M2 + M3 + M4);
   // document.getElementById("Test").innerHTML = `Pump Unit : <span style="color: green;">${valueToSend}</span>`;

    sendToFirebase(valueToSend);



  });



    motor3Toggle.addEventListener("change", () => { /// Motor 3 togal send firebase

    motor3_state = motor3Toggle.checked ? 1 : 0;

     if(motor3_state === 0){ M3 = "1"; } 
     if(motor3_state === 1){ M3 = "2"; } 

    updateModeDisplay();

    const valueToSend = motor3_state === 1 ? parseInt(A_M + M1 + M2 + M3 + M4) : parseInt(A_M + M1 + M2 + M3 + M4);
   // document.getElementById("Test").innerHTML = `Pump Unit : <span style="color: green;">${valueToSend}</span>`;

    sendToFirebase(valueToSend);



  });




    motor4Toggle.addEventListener("change", () => { /// Motor 3 togal send firebase

    motor4_state = motor4Toggle.checked ? 1 : 0;

     if(motor4_state === 0){ M4 = "1"; } 
     if(motor4_state === 1){ M4 = "2"; } 

    updateModeDisplay();

    const valueToSend = motor4_state === 1 ? parseInt(A_M + M1 + M2 + M3 + M4) : parseInt(A_M + M1 + M2 + M3 + M4);
   // document.getElementById("Test").innerHTML = `Pump Unit : <span style="color: green;">${valueToSend}</span>`;

    sendToFirebase(valueToSend);



  });





  function sendToFirebase(value) {
    const firebaseUrl = "https://uditha-2fc62-default-rtdb.asia-southeast1.firebasedatabase.app/on_off_motor.json?auth=0PfE9nU0OvR4CnRhVWMaQPFnSupj63CIGggX6bKU";

    fetch(firebaseUrl, {
      method: 'PUT',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(value)
    })
      .then(response => response.json())
      .then(result => {
        console.log("Firebase write success:", result);
      })
      .catch(error => {
        console.error("Firebase write failed:", error);
      });
  }

  window.onload = () => {
    updateToggleFromVariable();
  };






</script>







</body>
</html>
